---
title: "SHS income project - poverty"
output:
  bookdown::gitbook:
    config:
      fontsettings:
        family: sans
        theme: white
      sharing: no
      toc:
        collapse: section
        scroll_highlight: yes
    split_by: section+number
# output:
#   bookdown::word_document2:
#     reference_docx: template.docx
---

```{r setup, include = FALSE}

# Set global chunk options

knitr::opts_chunk$set(fig.width = 10, fig.asp = 0.5, 
                      echo = FALSE,
                      warning = FALSE)

# Load packages

library(plyr) # needed for groupwiseMedian function
library(tidyverse)
library(naniar) # for dealing with missing values
library(labelled) # to remove labels from imported data
library(scales) # for comma and percent formats
library(ggrepel) # for non-overlapping chart annotation
library(Hmisc) # for weighted quartiles
library(boot) # needed for groupwiseMedian function
library(readxl) # import Excel files
library(survey) # survey data analysis

# Load functions

source("scr/functions.R")

# Load colour scheme and other strings

source("scr/strings.R")
source("scr/colours.R")

# Load datasets

adult_1819 <- readRDS("output/adult_1819.rds")
househol_1819 <- readRDS("output/househol_1819.rds")
benefits_1819 <- readRDS("output/benefits_1819.rds")
hbai1819 <- readRDS("output/hbai1819.rds")
person18 <- readRDS("output/person18.rds")
hhold18 <- readRDS("output/hhold18.rds")

cilif_council <- read_excel("ext/docs/Cilif.xlsx", sheet = "council")
cilif_hhtype <- read_excel("ext/docs/Cilif.xlsx", sheet = "hhtype")
cilif_work <- read_excel("ext/docs/Cilif.xlsx", sheet = "work")
cilif_urbrur <- read_excel("ext/docs/Cilif.xlsx", sheet = "urbrur")

# Create tidy datasets

source("scr/prepSHSdata.R")
source("scr/prepHBAIdata.R")

# Combine all data

source("scr/prepdata.R")

# Change some theme elements (charts)

theme_update(legend.position = "top",
             legend.title = element_blank(),
             panel.background = element_blank(),
             panel.grid.major.x = element_blank(),
             panel.grid.minor.x = element_blank(),
             panel.grid.major.y = element_blank(),
             axis.ticks = element_blank(),
             text = element_text(size=16))

# Prepare SHS survey data for poverty analysis

## SHS survey design for child poverty

SHSpov_ch <- tidydata %>%
  filter(pnwgt == 0,
         type == "total",
         survey == "SHS") %>%
  mutate(allchildren = sum(chwgt),
         work = ifelse(HIHemp %in% c("Full-time Employee", "Part-time Employee", "Self-Employed"), 
                       "In working families",
                       "Not in working families"))

SHSpov_ch$urbrur <- decode(SHSpov_ch$urbrur,
                           search = urbrurclasses,
                           replace = urbrurclasses2)

SHSdesign_ch <- svydesign(id = ~ID, strata = ~council, weights = ~chwgt, data = SHSpov_ch, fpc = ~allchildren)

## SHS survey design for working age poverty

SHSpov_wa <- tidydata %>%
  filter(pnwgt == 0,
         type == "total",
         survey == "SHS") %>%
  mutate(alladults = sum(wawgt))

SHSdesign_wa <- svydesign(id = ~ID, strata = ~council, weights = ~wawgt, data = SHSpov_wa, fpc = ~alladults)

## SHS survey design for poverty excluding households with pensioners

SHSpov_pp <- tidydata %>%
  filter(pnwgt == 0,
         type == "total",
         survey == "SHS") %>%
  mutate(allpeople = sum(ppwgt))

SHSdesign_pp <- svydesign(id = ~ID, strata = ~council, weights = ~ppwgt, data = SHSpov_pp, fpc = ~allpeople)


```

# Introduction

Do SHS and FRS identify the same kind of households as being in poverty?

# Children, working-age adults and pensioners in relative poverty - comparison with HBAI

When looking at the number, composition and proportion of those in poverty, we can see that there are many more people in poverty in the SHS, largely driven by pensioners, whose poverty risk is exaggerated in the SHS.

Numbers in relative poverty:
```{r poverty_numbers}

tidydata %>%
  filter(type == "total") %>%
  group_by(survey, low60bhc) %>%
  summarise(people = comma(sum(ppwgt), 10000),
            children = comma(sum(chwgt), 10000),
            adults = comma(sum(wawgt), 10000),
            pensioners = comma(sum(pnwgt), 10000)) %>%
  filter(low60bhc == 1) %>%
  select(-low60bhc) %>%
  knitr::kable(align = "lrrrr")

```

Composition of those in relative poverty:
```{r poverty_composition}

tidydata %>%
  filter(type == "total") %>%
  group_by(survey, low60bhc) %>%
  summarise(people = sum(ppwgt),
            children = sum(chwgt),
            adults = sum(wawgt),
            pensioners = sum(pnwgt)) %>%
  mutate(children = percent(children/people, 1),
         adults = percent(adults/people, 1),
         pensioners = percent(pensioners/people, 1),
         people = percent(1, 1) ) %>%
  filter(low60bhc == 1) %>%
  select(-low60bhc) %>%
  knitr::kable(align = "lrrrr")

```

Proportion of individuals in relative poverty:
```{r poverty_rates}

tidydata %>%
  filter(type == "total") %>%
  group_by(survey, low60bhc) %>%
  summarise(people = sum(ppwgt),
            children = sum(chwgt),
            adults = sum(wawgt),
            pensioners = sum(pnwgt)) %>%
  mutate(people = percent(people/sum(people), 1),
         children = percent(children/sum(children), 1),
         adults = percent(adults/sum(adults), 1),
         pensioners = percent(pensioners/sum(pensioners), 1)) %>%
  filter(low60bhc == 1) %>%
  select(-low60bhc) %>%
  knitr::kable(align = "lrrrr")


```


# Comparison with HBAI (excluding pensioners)

## by household type 

```{r pov_hhtype}

SHS_pp_rate <- svyby(~low60bhc, ~hhtype, SHSdesign_pp, svymean, vartype=c("ci","ci")) %>%
    mutate(rate = low60bhc,
         lower =ci_l,
         upper = ci_u,
         survey = "SHS") %>%
  select(survey, hhtype, rate, lower, upper)

tidydata %>%
  filter(type == "total",
         survey == "HBAI",
         pnwgt == 0) %>%
  group_by(hhtype) %>%
  mutate(allpeople = sum(ppwgt),
         sample = n()) %>%
  group_by(hhtype, low60bhc) %>%
  summarise(people = sum(ppwgt),
            allpeople = max(allpeople),
            sample = max(sample)) %>%
  ungroup() %>%
  filter(low60bhc == 1,
         sample >= 100) %>%
  mutate(survey = "HBAI",
         rate = people/allpeople) %>%
  select(survey, hhtype, rate) %>%
  bind_rows(SHS_pp_rate) %>%
  mutate(hhtype = factor(hhtype),
         hhtype = fct_reorder2(hhtype, survey, desc(rate))) %>%
  ggplot(aes(x = hhtype, y = rate, colour = survey, ymin = lower, ymax = upper)) +
  geom_point(aes(size = survey),
             show.legend = FALSE) +
  geom_errorbar() +
  geom_text(aes(y = Inf, 
                label = ifelse(survey == "SHS",
                               str_c(percent(rate, 1)," (", percent(lower, 1), "-", percent(upper, 1), ")"), 
                               NA)),
            hjust = 1,
            show.legend = FALSE) +
  coord_flip() +
  scale_colour_manual(values = cols_survey) +
  scale_size_manual(values = c(3, 2)) +
  scale_y_continuous(limits = c(0,1), labels = percent_format()) +
  labs(x = NULL, y = NULL,
       title = str_wrap("Proportion of people in relative poverty by household type", 60),
       subtitle = str_wrap("Excludes households with pensioners; poverty is BHC; sample >= 100", 70))
  
```

## by economic status

```{r pov_eco}

SHS_pp_rate <- svyby(~low60bhc, ~HIHemp, SHSdesign_pp, svymean, vartype=c("ci","ci")) %>%
    mutate(rate = low60bhc,
         lower =ci_l,
         upper = ci_u,
         survey = "SHS") %>%
  select(survey, HIHemp, rate, lower, upper)

tidydata %>%
  filter(type == "total",
         survey == "HBAI",
         pnwgt == 0) %>%
  group_by(HIHemp) %>%
  mutate(allpeople = sum(ppwgt),
         sample = n()) %>%
  group_by(HIHemp, low60bhc) %>%
  summarise(people = sum(ppwgt),
            allpeople = max(allpeople),
            sample = max(sample)) %>%
  ungroup() %>%
  filter(low60bhc == 1,
         sample >= 100) %>%
  mutate(survey = "HBAI",
         rate = people/allpeople) %>%
  select(survey, HIHemp, rate) %>%
  bind_rows(SHS_pp_rate) %>%
  mutate(HIHemp = factor(HIHemp),
         HIHemp = fct_reorder2(HIHemp, survey, desc(rate))) %>%
  ggplot(aes(x = HIHemp, y = rate, colour = survey, ymin = lower, ymax = upper)) +
  geom_point(aes(size = survey),
             show.legend = FALSE) +
  geom_errorbar() +
  geom_text(aes(y = Inf, 
                label = ifelse(survey == "SHS",
                               str_c(percent(rate, 1)," (", percent(lower, 1), "-", percent(upper, 1), ")"), 
                               NA)),
            hjust = 1,
            show.legend = FALSE) +
  coord_flip() +
  scale_colour_manual(values = cols_survey) +
  scale_size_manual(values = c(3, 2)) +
  scale_y_continuous(limits = c(0,1), labels = percent_format()) +
  labs(x = NULL, y = NULL,
       title = str_wrap("Proportion of people in relative poverty by economic status of household head", 60),
       subtitle = str_wrap("Excludes households with pensioners; poverty is BHC; sample >= 100", 70))
  
```

## by council area

```{r pov_council, fig.asp = 0.9}

SHS_pp_rate <- svyby(~low60bhc, ~council, SHSdesign_pp, svymean, vartype=c("ci","ci")) %>%
    mutate(rate = low60bhc,
         lower =ci_l,
         upper = ci_u,
         survey = "SHS") %>%
  select(survey, council, rate, lower, upper)

tidydata %>%
  filter(type == "total",
         survey == "HBAI",
         pnwgt == 0) %>%
  group_by(council) %>% 
  mutate(allpeople = sum(ppwgt),
         sample = n()) %>% 
  group_by(council, low60bhc) %>%
  summarise(people = sum(ppwgt),
            allpeople = max(allpeople),
            sample = max(sample)) %>%  
  ungroup() %>%
  filter(low60bhc == 1,
         sample >= 100) %>%
  mutate(survey = "HBAI",
         rate = people/allpeople) %>%
  select(survey, council, rate) %>%
  bind_rows(SHS_pp_rate) %>%
  mutate(council = factor(council),
         council = fct_reorder2(council, survey, desc(rate))) %>%
  ggplot(aes(x = council, y = rate, colour = survey, ymin = lower, ymax = upper)) +
  geom_point(aes(size = survey),
             show.legend = FALSE) +
  geom_errorbar() +
  geom_text(aes(y = Inf, 
                label = ifelse(survey == "SHS",
                               str_c(percent(rate, 1)," (", percent(lower, 1), "-", percent(upper, 1), ")"), 
                               NA)),
            hjust = 1,
            show.legend = FALSE) +
  coord_flip() +
  scale_colour_manual(values = cols_survey) +
  scale_y_continuous(limits = c(0,1), labels = percent_format()) +
  scale_size_manual(values = c(3, 2)) +
  labs(x = NULL, y = NULL,
       title = str_wrap("Proportion of people in relative poverty by council area", 60),
       subtitle = str_wrap("Excludes households with pensioners; poverty is BHC; sample >= 100", 70))
  
```

## by urban/rural area

```{r pov_urb}

SHS_pp_rate <- svyby(~low60bhc, ~urbrur, SHSdesign_pp, svymean, vartype=c("ci","ci")) %>%
    mutate(rate = low60bhc,
         lower =ci_l,
         upper = ci_u,
         survey = "SHS") %>%
  select(survey, urbrur, rate, lower, upper)

tidydata %>%
  filter(type == "total",
         survey == "HBAI",
         pnwgt == 0) %>%
  group_by(urbrur) %>%
  mutate(allpeople = sum(ppwgt),
         sample = n()) %>%
  group_by(urbrur, low60bhc) %>%
  summarise(people = sum(ppwgt),
            allpeople = max(allpeople),
            sample = max(sample)) %>%
  ungroup() %>%
  filter(low60bhc == 1,
         sample >= 100) %>%
  mutate(survey = "HBAI",
         rate = people/allpeople) %>%
  select(survey, urbrur, rate) %>%
  bind_rows(SHS_pp_rate) %>%
  mutate(urbrur = factor(urbrur),
         urbrur = fct_reorder2(urbrur, survey, desc(rate))) %>%
  ggplot(aes(x = urbrur, y = rate, colour = survey, ymin = lower, ymax = upper)) +
  geom_point(aes(size = survey),
             show.legend = FALSE) +
  geom_errorbar() +
  geom_text(aes(y = Inf, 
                label = ifelse(survey == "SHS",
                               str_c(percent(rate, 1)," (", percent(lower, 1), "-", percent(upper, 1), ")"), 
                               NA)),
            hjust = 1,
            show.legend = FALSE) +
  coord_flip() +
  scale_colour_manual(values = cols_survey) +
  scale_y_continuous(limits = c(0,1), labels = percent_format()) +
  scale_size_manual(values = c(3, 2)) +
  labs(x = NULL, y = NULL,
       title = str_wrap("Proportion of people in relative poverty by urban / rural area", 60),
       subtitle = str_wrap("Excludes households with pensioners; poverty is BHC; sample >= 100", 70))
  
```

## by tenure

```{r pov_tenure}

SHS_pp_rate <- svyby(~low60bhc, ~tenure, SHSdesign_pp, svymean, vartype=c("ci","ci")) %>%
    mutate(rate = low60bhc,
         lower =ci_l,
         upper = ci_u,
         survey = "SHS") %>%
  select(survey, tenure, rate, lower, upper)

tidydata %>%
  filter(type == "total",
         survey == "HBAI",
         pnwgt == 0) %>%
  group_by(tenure) %>%
  mutate(allpeople = sum(ppwgt),
         sample = n()) %>%
  group_by(tenure, low60bhc) %>%
  summarise(people = sum(ppwgt),
            allpeople = max(allpeople),
            sample = max(sample)) %>%
  ungroup() %>%
  filter(low60bhc == 1,
         sample >= 100) %>%
  mutate(survey = "HBAI",
         rate = people/allpeople) %>%
  select(survey, tenure, rate) %>%
  bind_rows(SHS_pp_rate) %>%
  mutate(tenure = factor(tenure),
         tenure = fct_reorder2(tenure, survey, desc(rate))) %>%
  ggplot(aes(x = tenure, y = rate, colour = survey, ymin = lower, ymax = upper)) +
  geom_point(aes(size = survey),
             show.legend = FALSE) +
  geom_errorbar() +
  geom_text(aes(y = Inf, 
                label = ifelse(survey == "SHS",
                               str_c(percent(rate, 1)," (", percent(lower, 1), "-", percent(upper, 1), ")"), 
                               NA)),
            hjust = 1,
            show.legend = FALSE) +
  coord_flip() +
  scale_colour_manual(values = cols_survey) +
  scale_y_continuous(limits = c(0,1), labels = percent_format()) +
  scale_size_manual(values = c(3, 2)) +
  labs(x = NULL, y = NULL,
       title = str_wrap("Proportion of people in relative poverty by tenure", 60),
       subtitle = str_wrap("Excludes households with pensioners; poverty is BHC; sample >= 100", 70))
  
```

# Child poverty - comparison with CiLIF

Number of children in relative poverty:
```{r cilif_all}

allcilif <- cilif_council %>%
  summarise(CiLIF = sum(Cilif))

SHS_CI <- confint(svytotal(~low60bhc, SHSdesign_ch))

tidydata %>%
  filter(type == "total",
         low60bhc == 1) %>%
  group_by(survey) %>%
  summarise(SHS = sum(chwgt)) %>%
  spread(survey, SHS) %>%
  cbind(allcilif) %>%
  mutate(CiLIF = comma(CiLIF),
         HBAI = comma(HBAI, 10000),
         SHS = str_c(comma(SHS, 10000),
                     " (",
                     comma(SHS_CI[1], 10000),
                     "-",
                     comma(SHS_CI[2], 10000),
                     ")")) %>%
  knitr::kable(align = "rrr")
  

```

Note that the CiLIF figure by definition matches the official child poverty estimate for Scotland (200,000 children), which comes from the HBAI. The HBAI estimate in the table above however is based on a Scotland-data based poverty line and a slightly different definition of household income (it excludes children's incomes and is not adjusted for top incomes).

## by family type

Number of children in relative poverty:
```{r cilif_hhtype}

svyby(~low60bhc, ~hhtype, SHSdesign_ch, svytotal, vartype=c("ci","ci")) %>%
  filter(hhtype %in% c("Single adult with children", "Two adults with children")) %>%
  left_join(cilif_hhtype, by = "hhtype") %>%
  mutate(SHS = str_c(comma(low60bhc, 10000),
                     " (",
                     comma(ci_l, 10000),
                     "-",
                     comma(ci_u, 10000),
                     ")"),
         CiLIF = comma(Cilif)) %>%
  select(hhtype, SHS, CiLIF) %>%
  knitr::kable(align = "lrr")

```

## by work status

Number of children in relative poverty:
```{r cilif_eco}

svyby(~low60bhc, ~work, SHSdesign_ch, svytotal, vartype=c("ci","ci")) %>%
  left_join(cilif_work, by = "work") %>%
  mutate(SHS = str_c(comma(low60bhc, 10000),
                     " (",
                     comma(ci_l, 10000),
                     "-",
                     comma(ci_u, 10000),
                     ")"),
         CiLIF = comma(Cilif)) %>%
  select(work, SHS, CiLIF) %>%
  knitr::kable(align = "lrr")

```

## by council area

Number of children in relative poverty:
```{r cilif_council, fig.asp = 0.8}

cp <- tidydata %>%
  filter(type == "total",
         survey == "SHS",
         pnwgt == 0) %>%
  group_by(council) %>%
  mutate(allchildren = sum(chwgt),
         sample = n()) %>%
  group_by(council, low60bhc) %>%
  mutate(samplepov = ifelse(low60bhc == 1, sum(n()), 0)) %>%
  ungroup() %>%
  filter(samplepov >= 30)

cpnumbers <- svyby(~low60bhc, ~council, SHSdesign_ch, svytotal, vartype=c("ci","ci"))
  
cilifcomparison <- cpnumbers %>%
  left_join(cilif_council, by = "council") %>%
  mutate(council = fct_reorder(council, Cilif)) %>%
  rename(SHS = low60bhc ) %>%
  gather(source, children, -council,  -ci_l, -ci_u) %>%
  arrange(source)

corr <- cor.test(cilifcomparison$children[1:(length(cilifcomparison$children)/2)], cilifcomparison$children[(1+length(cilifcomparison$children)/2):length(cilifcomparison$children)], method=c("pearson", "kendall", "spearman"))

Pearson <- corr$estimate

cilifcomparison %>%
  mutate(council = factor(council),
         council = fct_reorder2(council, source, desc(children))) %>%
  ggplot(aes(x = council, y = children, colour = source)) +
  geom_point(aes(size = source)) +
  geom_errorbar(data = filter(cilifcomparison, source == "SHS"),
                aes(ymin = ci_l,
                    ymax = ci_u)) +
  coord_flip() +
  scale_colour_manual(values = wes_palettes[["Moonrise2"]]) +
  scale_size_manual(values = c(3,2)) +
  scale_y_continuous(labels = comma_format()) +
  labs(x = NULL, y = NULL,
       title = str_wrap("Number of children in relative poverty BHC by council, SHS and CiLIF", 60),
       subtitle = str_wrap("Excludes council areas with SHS samples (in poverty) < 30", 70)) +
  annotate("text", x = 3, y = Inf, label = str_c("Pearson correlation: ", percent(Pearson, 0.1)), hjust = 1)

```

## by urban/rural area

Number of children in relative poverty:
```{r cilif_urbrur}

cilif_urbrur <- cilif_urbrur %>%
  mutate(urbrur = ifelse(urbrur %in% c("Accessible Small Towns", "Remote Small Towns"), "Small Towns",
                         ifelse(urbrur %in% c("Accessible Rural", "Remote Rural"), "Rural", urbrur))) %>%
  group_by(urbrur) %>%
  summarise(Cilif = sum(Cilif))


svyby(~low60bhc, ~urbrur, SHSdesign_ch, svytotal, vartype=c("ci","ci")) %>%
  left_join(cilif_urbrur, by = "urbrur") %>%
  mutate(SHS = str_c(comma(low60bhc, 10000),
                     " (",
                     comma(ci_l, 10000),
                     "-",
                     comma(ci_u, 10000),
                     ")"),
         CiLIF = comma(Cilif)) %>%
  select(urbrur, SHS, CiLIF) %>%
  knitr::kable(align = "lrr")

```

# Comparison with SIMD

```{r cpov_simd_ci}

cp <- tidydata %>%
  filter(type == "total",
         survey == "SHS",
         pnwgt == 0) %>%
  mutate(simd = factor(simd),
         simdquint = fct_collapse(simd, 
                             "1" = c("1","2"),
                             "2" = c("3", "4"),
                             "3" = c("5", "6"),
                             "4" = c("7", "8"),
                             "5" = c("9", "10"))) %>%
  group_by(simdquint) %>%
  mutate(allchildren = sum(chwgt),
         sample = n()) %>%
  ungroup()

SHSdesign <- svydesign(id = ~1, strata = ~council, weights = ~chwgt, data = cp, fpc = ~allchildren)

cprates <- svyby(~low60bhc, ~simdquint, SHSdesign, svymean, vartype=c("se","ci","ci"))

cprates %>%
 ggplot(aes(x = simdquint, y =  low60bhc, ymin = ci_l, ymax = ci_u)) +
  geom_point() +
  geom_errorbar() +
  geom_text(aes(y = 0.6, label = str_c(percent(low60bhc, 1), " (", percent(ci_l, 1), "-", percent(ci_u, 1), ")")),
            hjust = 0) +
  labs(x = NULL, y = NULL,
       title = "Proportion of children in relative poverty BHC by SIMD quintile",
       subtitle = "Excludes households with pensioners") +
  scale_y_continuous(limits = c(-0.1, 0.8), labels = NULL) +
  coord_flip()

```

# Comparison with financial attitudes

```{r managing_financially_pov_exc}

tidydata %>%
  filter(survey == "SHS",
         type == "total",
         !is.na(finman),
         pnwgt == 0) %>%
  group_by(low60bhc, finman) %>%
  summarise(fm = sum(ppwgt)) %>%
  ungroup() %>%
  group_by(low60bhc) %>%
  mutate(people = sum(fm),
         fmrate = fm/people) %>%
  ungroup() %>%
  mutate(low60bhc = factor(low60bhc)) %>%
  ggplot(aes(x = low60bhc, y = fmrate, fill = finman)) + 
  geom_col(position = "stack", colour = "white") +
  coord_flip() +
  scale_x_discrete(labels = c("Not in poverty", "In poverty")) +
  scale_y_continuous(labels = percent_format()) +
  scale_fill_manual(values = cols_finman) +
  labs(x = NULL, y = NULL,
       title = "How households are managing financially by poverty status",
       subtitle = "Excludes households with pensioners, but income deciles based on all households") +
  theme(legend.position = "right")

```

```{r managing_financially_exc}

tidydata %>%
  filter(survey == "SHS",
         type == "total",
         !is.na(finman),
         pnwgt == 0) %>%
  group_by(decile, finman) %>%
  summarise(fm = sum(ppwgt)) %>%
  ungroup() %>%
  group_by(decile) %>%
  mutate(people = sum(fm),
         fmrate = fm/people) %>%
  ungroup() %>%
  mutate(decile = factor(decile)) %>%
  ggplot(aes(x = decile, y = fmrate, fill = finman)) + 
  geom_col(position = "stack", colour = "white") +
  coord_flip() +
  scale_y_continuous(labels = percent_format()) +
  scale_fill_manual(values = cols_finman) +
  labs(x = NULL, y = NULL,
       title = "How households are managing financially by income decile",
       subtitle = "Excludes households with pensioners, but income deciles based on all households") +
  theme(legend.position = "right")

```

# Comparison with material deprivation

```{r matdep}

tidydata %>%
  filter(survey == "SHS",
         type == "total") %>%
  group_by(decile, md) %>%
  summarise(mdhh = sum(hhwgt)) %>%
  group_by(decile) %>%
  mutate(allhouseholds = sum(mdhh),
         rate = mdhh/allhouseholds)  %>%

  ggplot(aes(x = decile, y = rate, fill = md)) +
  geom_col()

```



